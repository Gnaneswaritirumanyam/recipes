<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/static/styles.css">
<style>
  body, html {
    height: 100%;
    margin: 0;
    font-family: Arial, sans-serif;
  }

  /* Background video */
  .bg-video {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    object-fit: cover;
    z-index: -1;
  }
/* Glass effect login form */
.glass-form {
  background: rgba(255, 255, 255, 0.22);
  backdrop-filter: saturate(180%) blur(14px);
  -webkit-backdrop-filter: saturate(180%) blur(14px);
  padding: 4rem 3rem;             /* More space inside */
  border-radius: 20px;            /* Slightly larger rounded corners */
  max-width: 400px;               /* Increased width */
  width: 95%;
  text-align: center;
  box-shadow: 0 0 50px rgba(0, 0, 0, 0.25);
  font-size: 1.2rem;              /* Increased overall font size */
}

.form-control {
  margin-bottom: 1rem;
  font-size: 1.05rem;             /* Larger input text */
  padding: 0.75rem 1rem;
}

.text-danger {
  font-size: 0.9rem;
}

.forgot-link {
  font-size: 1rem;
  cursor: pointer;
}

/* Button styling */
.btn-primary {
  background-color: #ff5722;
  border-color: #ff5722;
  font-size: 1.1rem;
  padding: 0.75rem 1.25rem;
  border-radius: 8px;
}
.btn-primary:hover {
  background-color: #e64a19;
  border-color: #e64a19;
}

  /* Success video overlay */
  #successVideo {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 9999;
    display: none;
  }
.video-wrapper {
  position: relative;
  width: 100%;
  height: 100vh; /* full screen */
  overflow: hidden;
}


/* Mobile responsiveness fix */
@media (max-width: 768px) {
  #successVideo {
    object-fit: contain; /* show entire video (no crop) */
    background-color: black; /* add black bars if needed */
  }
}

</style>
</head>
<body>

<!-- Background video -->
<video autoplay muted loop playsinline class="bg-video">
  <source src="/static/recipes_images/video.mp4" type="video/mp4">
</video>

<!-- Login form -->
<div class="d-flex justify-content-center align-items-center min-vh-100">
  <div class="glass-form">
    <h2 class="mb-4">Login</h2>
    <form id="loginForm" novalidate>
      <input type="email" id="email" class="form-control" placeholder="name@gmail.com" required>
      <div class="text-danger" id="emailError"></div>

      <input type="password" id="password" class="form-control" placeholder="Password" required>
      <div class="text-danger" id="passwordError"></div>

      <div class="mb-2 text-end">
        <span class="forgot-link" id="forgotPasswordLink">Forgot Password?</span>
      </div>

      <button type="submit" class="btn btn-primary w-100">Log In</button>
      <p class="mt-3 small">Don't have an account? <a href="/" style="color:#e64a19;">Sign up</a></p>
    </form>
  </div>
</div>

<!-- Forgot Password Modal -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Reset Password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="email" id="resetEmail" class="form-control" placeholder="Enter your Gmail">
        <div class="text-danger mt-1" id="resetEmailError"></div>
      </div>
      <div class="modal-footer">
        <button type="button" id="resetPasswordBtn" class="btn btn-primary w-100">Send Reset Link</button>
      </div>
    </div>
  </div>
</div>

<!-- Success video (hidden by default) -->
<div class="video-wrapper">
  <video id="successVideo" autoplay muted loop playsinline>
    <source src="/static/images/login.mp4" type="video/mp4">
  </video>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const emailRegex = /^[a-zA-Z0-9._%+-]+@gmail\.com$/;

// ===== LOGIN FORM =====
document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  document.getElementById('emailError').innerText = '';
  document.getElementById('passwordError').innerText = '';
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  let hasError = false;

  if (!emailRegex.test(email)) {
    document.getElementById('emailError').innerText = 'Please enter a valid Gmail';
    hasError = true;
  }
  if (!password) {
    document.getElementById('passwordError').innerText = 'Please enter your password';
    hasError = true;
  }
  if (hasError) return;

  try {
    const response = await fetch('/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password }),
      credentials: 'include'
    });
    const data = await response.json();
    if (response.ok) {
  localStorage.setItem("user_name", data.name);
// Show and play success video with sound
const successVideo = document.getElementById('successVideo');
const form = document.querySelector('.glass-form');

// Hide form
if (form) form.style.display = 'none';

// Show video
successVideo.style.display = 'block';
successVideo.currentTime = 0;

// Try playing with sound
successVideo.muted = false;
const playPromise = successVideo.play();

if (playPromise !== undefined) {
  playPromise.catch(error => {
    console.warn("Autoplay with sound blocked, retrying muted...");
    successVideo.muted = true;
    successVideo.play();
  });
}

// When video ends, redirect to dashboard
successVideo.onended = () => {
  window.location.href = "/dashboard";
};

// Fallback redirect (after 8.5s)
setTimeout(() => {
  window.location.href = "/dashboard";
}, 8500);

} else {
  alert(data.detail || 'Login failed');
}
  } catch (err) {
    console.error("Login error:", err);
    alert('Server error. Try again later.');
  }
});

// ===== Forgot Password Modal =====
const forgotModal = new bootstrap.Modal(document.getElementById('forgotPasswordModal'));
document.getElementById('forgotPasswordLink').addEventListener('click', () => forgotModal.show());

document.getElementById('resetPasswordBtn').addEventListener('click', async () => {
  const email = document.getElementById('resetEmail').value.trim();
  document.getElementById('resetEmailError').innerText = '';
  if (!emailRegex.test(email)) {
    document.getElementById('resetEmailError').innerText = 'Enter a valid Gmail';
    return;
  }

  try {
    const response = await fetch('/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });
    const data = await response.json();

    if (response.ok) {
      alert('Password reset link sent! Check your email.');
      forgotModal.hide();
    } else {
      alert(data.detail || 'Failed to send reset link.');
    }

  } catch (err) {
    console.error("Reset error:", err);
    alert('Server error. Try again later.');
  }
});
</script>
</body>
</html>
